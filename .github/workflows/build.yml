name: Build

on: workflow_dispatch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
     # - uses: actions/checkout@v2
      - uses: rokibhasansagar/slimhub_actions@main

      - name: Re-install requirements
        run: |
          sudo apt update
          sudo apt install bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev lib32z1-dev liblz4-tool libncurses5-dev libsdl1.2-dev libssl-dev libwxgtk3.0-gtk3-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev
          curl -O https://storage.googleapis.com/git-repo-downloads/repo
         
      - name: Initialise ROM repo
        run: |
          python repo init --depth=1 --no-repo-verify -u git://github.com/AOSiP/platform_manifest.git -b pie -g default,-mips,-darwin,-notdefault
 
      - name: Clone device repo
        run: |
          git clone https://github.com/indi121/local_manifests.git --depth 1 -b pie .repo/local_manifests
      - name: Start sync
        run: |
          python repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j4
          git config --global user.email "indira1aryal@gmail.com"
          git config --global user.name "indi121"
          cd build/soong && git fetch https://github.com/masemoel/build_soong_legion-r 11 && git cherry-pick b45c5ae22f74f1bdbb9bfbdd06ecf7a25033c78b && git cherry-pick e020f2130224fbdbec1f83e3adfd06a9764cca87 && cd ../.
      - name: test rum
        run: |
          source build/envsetup.sh
          lunch aosip_vince-userdebug
          export LC_ALL=C
          mka kronic -j4
